<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Treinador de Algoritmos - Cubo M√°gico</title>
    <style>
        :root {
            --primary: #3b82f6;
            --secondary: #10b981;
            --tertiary: #f59e0b;
            --danger: #ef4444;
            --bg: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text: #f1f5f9;
            --text-secondary: #cbd5e1;
            --border: #334155;
            --shadow: rgba(0, 0, 0, 0.5);
            --algorithm-bg: #1a2332;
            --algorithm-border: #2563eb;
            --font-size-base: 16px;
            --font-size-lg: 20px;
            --font-size-xl: 24px;
            --font-size-2xl: 32px;
        }

        [data-theme="light"] {
            --primary: #2563eb;
            --secondary: #10b981;
            --tertiary: #f59e0b;
            --danger: #ef4444;
            --bg: #f3f4f6;
            --bg-secondary: #ffffff;
            --bg-tertiary: #e5e7eb;
            --text: #1f2937;
            --text-secondary: #6b7280;
            --border: #e5e7eb;
            --shadow: rgba(0, 0, 0, 0.1);
            --algorithm-bg: #f9fafb;
            --algorithm-border: #ddd6fe;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            font-size: var(--font-size-base);
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        body.font-small {
            --font-size-base: 14px;
            --font-size-lg: 18px;
            --font-size-xl: 22px;
            --font-size-2xl: 28px;
        }

        body.font-large {
            --font-size-base: 18px;
            --font-size-lg: 22px;
            --font-size-xl: 26px;
            --font-size-2xl: 36px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background-color: var(--bg-secondary);
            padding: 20px;
            box-shadow: 0 2px 4px var(--shadow);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: var(--font-size-xl);
            color: var(--primary);
            text-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
            font-weight: 700;
        }

        .btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: var(--font-size-base);
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            font-weight: 500;
        }

        .btn:hover {
            background-color: #1d4ed8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background-color: var(--secondary);
        }

        .btn-secondary:hover {
            background-color: #059669;
        }

        .btn-tertiary {
            background-color: var(--tertiary);
            font-weight: 600;
        }

        .btn-tertiary:hover {
            background-color: #d97706;
        }

        .btn-danger {
            background-color: var(--danger);
        }

        .btn-danger:hover {
            background-color: #dc2626;
        }

        .btn-outline {
            background-color: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-outline:hover {
            background-color: var(--primary);
            color: white;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }

        .btn-icon {
            background-color: transparent;
            color: var(--text);
            padding: 8px;
            font-size: var(--font-size-lg);
            transition: all 0.3s ease;
        }

        .btn-icon:hover {
            background-color: var(--bg-tertiary);
            border-radius: 8px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }

        .card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px var(--shadow);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px var(--shadow);
            border-color: var(--primary);
        }

        .card h2 {
            font-size: var(--font-size-lg);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card .info {
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        .card .progress {
            background-color: var(--bg-tertiary);
            height: 8px;
            border-radius: 4px;
            margin-bottom: 16px;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .card .progress-bar {
            background-color: var(--secondary);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
        }

        .card .actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        .algorithm-display {
            background-color: var(--algorithm-bg);
            border: 2px solid var(--algorithm-border);
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            box-shadow: 0 4px 16px var(--shadow);
            backdrop-filter: blur(10px);
        }

        .algorithm-display h2 {
            font-size: var(--font-size-2xl);
            font-family: 'Courier New', monospace;
            margin-bottom: 20px;
            color: var(--primary);
            letter-spacing: 2px;
            text-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }

        .algorithm-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            margin-bottom: 20px;
        }

        .status-new {
            background-color: #3b82f6;
            color: #e0e7ff;
            font-weight: 600;
        }

        .status-reviewing {
            background-color: #f59e0b;
            color: #fef3c7;
            font-weight: 600;
        }

        .status-mastered {
            background-color: #10b981;
            color: #d1fae5;
            font-weight: 600;
        }

        [data-theme="light"] .status-new {
            background-color: #dbeafe;
            color: #1e40af;
        }

        [data-theme="light"] .status-reviewing {
            background-color: #fef3c7;
            color: #92400e;
        }

        [data-theme="light"] .status-mastered {
            background-color: #d1fae5;
            color: #065f46;
        }

        .solution-area {
            margin-top: 20px;
            padding: 20px;
            background-color: var(--algorithm-bg);
            border: 2px solid var(--secondary);
            border-radius: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px var(--shadow);
        }

        .solution-area.hidden {
            display: none;
        }

        .solution-text {
            font-size: var(--font-size-xl);
            font-family: 'Courier New', monospace;
            color: var(--secondary);
            letter-spacing: 2px;
            text-shadow: 0 0 15px rgba(16, 185, 129, 0.5);
        }

        .controls {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 30px;
        }

        .progress-bar-container {
            background-color: var(--bg-tertiary);
            height: 8px;
            border-radius: 4px;
            margin: 30px 0;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .progress-bar-fill {
            background-color: var(--secondary);
            height: 100%;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
        }

        .counter {
            text-align: center;
            font-size: var(--font-size-lg);
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .algorithm-list {
            max-height: 500px;
            overflow-y: auto;
            margin: 20px 0;
        }

        .algorithm-item {
            display: flex;
            align-items: center;
            padding: 16px;
            background-color: var(--algorithm-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }

        .algorithm-item:hover {
            background-color: var(--bg-tertiary);
            border-color: var(--primary);
            transform: translateX(4px);
        }

        .algorithm-item.selected {
            background-color: #1e3a8a;
            border: 2px solid var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        [data-theme="light"] .algorithm-item.selected {
            background-color: #dbeafe;
            border: 2px solid var(--primary);
        }

        .algorithm-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 16px;
            cursor: pointer;
        }

        .algorithm-item-content {
            flex: 1;
        }

        .algorithm-item-case {
            font-family: 'Courier New', monospace;
            font-size: var(--font-size-base);
            margin-bottom: 4px;
            color: var(--primary);
            font-weight: 600;
        }

        .algorithm-item-solution {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: var(--secondary);
        }

        .selection-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .selection-counter {
            background-color: var(--primary);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.4);
        }

        .settings-section {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px var(--shadow);
        }

        .settings-section h3 {
            margin-bottom: 16px;
            font-size: var(--font-size-lg);
        }

        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }

        .settings-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border);
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--bg-secondary);
            padding: 32px;
            border-radius: 12px;
            box-shadow: 0 8px 32px var(--shadow);
            border: 1px solid var(--border);
            max-width: 500px;
            width: 90%;
            text-align: center;
        }

        .modal-content h2 {
            margin-bottom: 16px;
            font-size: var(--font-size-xl);
        }

        .modal-content p {
            margin-bottom: 24px;
            color: var(--text-secondary);
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }

        .stat-card {
            background-color: var(--algorithm-bg);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .stat-value {
            font-size: var(--font-size-2xl);
            font-weight: bold;
            color: var(--primary);
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .select-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .select-group label {
            font-weight: 500;
        }

        select {
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background-color: var(--bg-tertiary);
            color: var(--text);
            font-size: var(--font-size-base);
            cursor: pointer;
        }

        select:focus {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 12px;
            }

            .grid {
                grid-template-columns: 1fr;
            }

            .controls {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .selection-controls {
                flex-direction: column;
            }

            .algorithm-display {
                padding: 20px;
            }

            .modal-actions {
                flex-direction: column;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.3s ease;
        }

        @keyframes shake {
            0%, 100% {
                transform: translateX(0);
            }
            25% {
                transform: translateX(-10px);
            }
            75% {
                transform: translateX(10px);
            }
        }

        .shake {
            animation: shake 0.5s ease;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--bg-tertiary);
            border-radius: 4px;
            border: 1px solid var(--border);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
    </style>
</head>
<body data-theme="dark">
    <div class="header">
        <h1>Treinador de Algoritmos - Cubo M√°gico</h1>
        <button class="btn btn-icon" onclick="showScreen('settings')">‚öôÔ∏è</button>
    </div>

    <!-- Tela Inicial -->
    <div id="home" class="screen active">
        <div class="container">
            <div class="grid">
                <!-- Card F2L -->
                <div class="card fade-in">
                    <h2>üîÑ F2L (First Two Layers)</h2>
                    <div class="info">41 algoritmos dispon√≠veis</div>
                    <div class="progress">
                        <div class="progress-bar" id="f2l-progress"></div>
                    </div>
                    <div class="info" id="f2l-progress-text">0/41 conclu√≠dos</div>
                    <div class="actions">
                        <button class="btn" onclick="startTraining('F2L')">Treinar Todos</button>
                        <button class="btn btn-secondary" onclick="showSelection('F2L')">Selecionar para Revis√£o</button>
                        <button class="btn btn-danger" onclick="confirmReset('F2L')">Resetar</button>
                    </div>
                </div>

                <!-- Card OLL -->
                <div class="card fade-in" style="animation-delay: 0.1s">
                    <h2>‚¨ÜÔ∏è OLL (Orientation of Last Layer)</h2>
                    <div class="info">57 algoritmos dispon√≠veis</div>
                    <div class="progress">
                        <div class="progress-bar" id="oll-progress"></div>
                    </div>
                    <div class="info" id="oll-progress-text">0/57 conclu√≠dos</div>
                    <div class="actions">
                        <button class="btn" onclick="startTraining('OLL')">Treinar Todos</button>
                        <button class="btn btn-secondary" onclick="showSelection('OLL')">Selecionar para Revis√£o</button>
                        <button class="btn btn-danger" onclick="confirmReset('OLL')">Resetar</button>
                    </div>
                </div>

                <!-- Card PLL -->
                <div class="card fade-in" style="animation-delay: 0.2s">
                    <h2>‚Ü©Ô∏è PLL (Permutation of Last Layer)</h2>
                    <div class="info">21 algoritmos dispon√≠veis</div>
                    <div class="progress">
                        <div class="progress-bar" id="pll-progress"></div>
                    </div>
                    <div class="info" id="pll-progress-text">0/21 conclu√≠dos</div>
                    <div class="actions">
                        <button class="btn" onclick="startTraining('PLL')">Treinar Todos</button>
                        <button class="btn btn-secondary" onclick="showSelection('PLL')">Selecionar para Revis√£o</button>
                        <button class="btn btn-danger" onclick="confirmReset('PLL')">Resetar</button>
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 40px;">
                <button class="btn btn-danger" onclick="confirmReset('ALL')">üóëÔ∏è Resetar Todos os Dados</button>
            </div>
        </div>
    </div>

    <!-- Tela de Treino -->
    <div id="training" class="screen">
        <div class="container">
            <button class="btn btn-outline" onclick="showScreen('home')">‚Üê Voltar</button>
            <h2 id="training-title" style="text-align: center; margin: 20px 0; font-size: var(--font-size-xl);">Treino de F2L</h2>
            <div class="counter" id="training-counter">Algoritmo 1 de 41</div>

            <div class="algorithm-display">
                <div class="algorithm-status status-new" id="algorithm-status">Novo</div>
                <h2 id="algorithm-case">R U' R'</h2>
            </div>

            <div class="solution-area hidden" id="solution-area">
                <h3>Solu√ß√£o:</h3>
                <div class="solution-text" id="solution-text">R U R'</div>
            </div>

            <div class="controls">
                <button class="btn" onclick="nextAlgorithm()">Sortear Pr√≥ximo</button>
                <button class="btn btn-secondary" onclick="toggleSolution()">Mostrar/Ocultar Solu√ß√£o</button>
                <button class="btn btn-tertiary" onclick="markAsMastered()">Marcar como Dominado</button>
            </div>

            <div class="progress-bar-container">
                <div class="progress-bar-fill" id="training-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Tela de Sele√ß√£o -->
    <div id="selection" class="screen">
        <div class="container">
            <button class="btn btn-outline" onclick="showScreen('home')">‚Üê Voltar</button>
            <h2 style="text-align: center; margin: 20px 0; font-size: var(--font-size-xl);">Selecionar Algoritmos para Revis√£o</h2>
            
            <div class="selection-controls">
                <button class="btn btn-outline" onclick="selectAll()">Selecionar Todos</button>
                <button class="btn btn-outline" onclick="clearSelection()">Limpar Sele√ß√£o</button>
                <button class="btn btn-outline" onclick="selectNonMastered()">Apenas N√£o Dominados</button>
                <button class="btn btn-outline" onclick="selectMastered()">Apenas Dominados</button>
                <button class="btn btn-tertiary" onclick="selectMultiple(5)">+5</button>
                <button class="btn btn-tertiary" onclick="selectMultiple(10)">+10</button>
                <button class="btn btn-tertiary" onclick="selectMultiple(20)">+20</button>
                <div class="selection-counter" id="selection-counter">0 selecionados</div>
            </div>

            <div class="algorithm-list" id="algorithm-list"></div>

            <button class="btn btn-primary" style="width: 100%; margin-top: 20px;" onclick="startReview()" id="start-review-btn">Iniciar Revis√£o com 0 Algoritmos</button>
        </div>
    </div>

    <!-- Tela de Configura√ß√µes -->
    <div id="settings" class="screen">
        <div class="container">
            <button class="btn btn-outline" onclick="showScreen('home')">‚Üê Voltar</button>
            <h2 style="text-align: center; margin: 20px 0; font-size: var(--font-size-xl);">Configura√ß√µes</h2>

            <div class="settings-section">
                <h3>Apar√™ncia</h3>
                <div class="settings-item">
                    <span>Modo Escuro</span>
                    <label class="switch">
                        <input type="checkbox" id="dark-mode-toggle" onchange="toggleDarkMode()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="settings-item">
                    <span>Tamanho da Fonte</span>
                    <select id="font-size-select" onchange="changeFontSize()">
                        <option value="small">Pequena</option>
                        <option value="normal" selected>Normal</option>
                        <option value="large">Grande</option>
                    </select>
                </div>
            </div>

            <div class="settings-section">
                <h3>Modo de Treino</h3>
                <div class="settings-item">
                    <span>Incluir Algoritmos Dominados</span>
                    <label class="switch">
                        <input type="checkbox" id="include-mastered" onchange="saveSettings()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="settings-item">
                    <span>Modo Reverso (Mostrar solu√ß√£o primeiro)</span>
                    <label class="switch">
                        <input type="checkbox" id="reverse-mode" onchange="saveSettings()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="settings-item">
                    <span>Som de Feedback</span>
                    <label class="switch">
                        <input type="checkbox" id="sound-enabled" onchange="saveSettings()">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <div class="settings-section">
                <h3>Estat√≠sticas</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="total-practiced">0</div>
                        <div class="stat-label">Algoritmos Praticados</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-mastered">0</div>
                        <div class="stat-label">Algoritmos Dominados</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="review-sessions">0</div>
                        <div class="stat-label">Sess√µes de Revis√£o</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="current-streak">0</div>
                        <div class="stat-label">Sequ√™ncia Atual</div>
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <h3>Gerenciamento de Dados</h3>
                <div class="settings-item">
                    <span>Exportar Dados</span>
                    <button class="btn btn-secondary" onclick="exportData()">Exportar</button>
                </div>
                <div class="settings-item">
                    <span>Importar Dados</span>
                    <button class="btn btn-secondary" onclick="importData()">Importar</button>
                </div>
                <div class="settings-item">
                    <span>Resetar Todos os Dados</span>
                    <button class="btn btn-danger" onclick="confirmReset('ALL')">Resetar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Confirma√ß√£o -->
    <div id="confirm-modal" class="modal">
        <div class="modal-content">
            <h2 id="modal-title">Resetar Dados</h2>
            <p id="modal-message">Tem certeza que deseja resetar?</p>
            <div class="modal-actions">
                <button class="btn btn-danger" onclick="confirmAction()">‚úÖ Sim</button>
                <button class="btn btn-secondary" onclick="closeModal()">‚ùå N√£o</button>
            </div>
        </div>
    </div>

    <!-- Modal de Fim de Sess√£o -->
    <div id="end-session-modal" class="modal">
        <div class="modal-content">
            <h2>üéâ Todos os algoritmos j√° foram sorteados!</h2>
            <p>Voc√™ praticou todos os algoritmos dispon√≠veis nesta sess√£o.</p>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="restartSession()">‚úÖ Sim, Recome√ßar</button>
                <button class="btn btn-secondary" onclick="endSession()">‚ùå N√£o, Voltar</button>
            </div>
        </div>
    </div>

    <script>
        // Dados dos algoritmos
        const algorithmData = {
            F2L: [
                { id: "f2l_001", case: "R U' R'", solution: "R U R'" },
                { id: "f2l_002", case: "L' U L", solution: "L' U' L" },
                { id: "f2l_003", case: "R U R' U'", solution: "U R U' R'" },
                { id: "f2l_004", case: "L' U' L U", solution: "U' L' U L" },
                { id: "f2l_005", case: "F' U' F U R U R' U'", solution: "U R U' R' U' F' U F" },
                { id: "f2l_006", case: "F U F' U' L' U' L U", solution: "U' L' U L U F U' F'" },
                { id: "f2l_007", case: "L' U' L U L' U' L", solution: "L' U L U' L' U L" },
                { id: "f2l_008", case: "R U' R' U R U' R'", solution: "R U R' U' R U R'" },
                { id: "f2l_009", case: "R U R' U' R U R'", solution: "R U' R' U R U' R'" },
                { id: "f2l_010", case: "L' U L U' L' U L", solution: "L' U' L U L' U' L" },
                { id: "f2l_011", case: "R U' R' U R U' R' U R U' R'", solution: "R U R' U' R U R' U' R U R'" },
                { id: "f2l_012", case: "L' U2 L y' R U R'", solution: "R U' R' y L' U2 L" },
                { id: "f2l_013", case: "R U' R' U2 R U' R' U'", solution: "U R U R' U2 R U R'" },
                { id: "f2l_014", case: "R U' R' U F' U F U'", solution: "U F' U' F U' R U R'" },
                { id: "f2l_015", case: "R U R' U2 R U R' U", solution: "U' R U' R' U2 R U' R'" },
                { id: "f2l_016", case: "R' U R Dw' R U' R' U", solution: "U' R U R' Dw R' U' R" },
                { id: "f2l_017", case: "R' U R Dw' U' R U R'", solution: "R U' R' U Dw R' U' R" },
                { id: "f2l_018", case: "R' U' R U2 R' U2 R Dw'", solution: "Dw R' U2 R U2 R' U R" },
                { id: "f2l_019", case: "R' U' R U2 R' U R Dw'", solution: "Dw R' U' R U2 R' U R" },
                { id: "f2l_020", case: "R U' R' U' R U R' U", solution: "U' R U' R' U R U R'" },
                { id: "f2l_021", case: "R U' R' U' R U' R' U", solution: "U' R U R' U R U R'" },
                { id: "f2l_022", case: "R U' R' Dw R' U2 R Dw'", solution: "Dw R' U2 R Dw' R U R'" },
                { id: "f2l_023", case: "R U R' U' R U R' U2 R U' R'", solution: "R U R' U2 R U' R' U R U' R'" },
                { id: "f2l_024", case: "R U R' U2 R U2 R' U", solution: "U' R U2 R' U2 R U' R'" },
                { id: "f2l_025", case: "R U R' U2 R U' R' U", solution: "U' R U R' U2 R U' R'" },
                { id: "f2l_026", case: "R' U R U R' U' R Dw'", solution: "Dw R' U R U' R' U' R" },
                { id: "f2l_027", case: "F' U F U' R U R' U", solution: "U' R U' R' U F' U' F" },
                { id: "f2l_028", case: "F' U F U' R U2 R' U", solution: "U' R U2 R' U F' U' F" },
                { id: "f2l_029", case: "R U' R' U R U' R' U2 R U' R'", solution: "R U R' U2 R U R' U' R U R'" },
                { id: "f2l_030", case: "R U R' U' R U' R' U2", solution: "U2 R U R' U R U' R'" },
                { id: "f2l_031", case: "R U R' U' R U2 R' U'", solution: "U R U2 R' U R U' R'" },
                { id: "f2l_032", case: "R U' R' U R U2 R'", solution: "R U2 R' U' R U R'" },
                { id: "f2l_033", case: "R U R' F R U R' U' F'", solution: "F U R U' R' F' R U' R'" },
                { id: "f2l_034", case: "F' L' U2 L F", solution: "F' L' U2 L F" },
                { id: "f2l_035", case: "L' U' L U L' U2 L U y'", solution: "y U' L' U2 L U' L' U L" },
                { id: "f2l_036", case: "L' U L U' L' U2 L y'", solution: "y L' U2 L U L' U' L" },
                { id: "f2l_037", case: "R' U2 R U' R' U2 R Dw' R U R'", solution: "R U' R' Dw R' U2 R U R' U2 R" },
                { id: "f2l_038", case: "R U' R' U' R U R' U2 R U' R'", solution: "R U R' U2 R U' R' U R U R'" },
                { id: "f2l_039", case: "R U' R' U R U2 R' U R U' R'", solution: "R U R' U' R U2 R' U' R U R'" },
                { id: "f2l_040", case: "F' U F U2 R U R' U R U' R'", solution: "R U R' U' R U' R' U2 F' U' F" },
                { id: "f2l_041", case: "R' U R U R' U R Dw' R U R'", solution: "R U' R' Dw R' U' R U' R' U' R" }
            ],
            OLL: [
                { id: "oll_001", case: "R U2 R' U' R U' R'", solution: "R U R' U R U2 R'" },
                { id: "oll_002", case: "R' U2 R U R' U R", solution: "R' U' R U' R' U2 R" },
                { id: "oll_003", case: "R U2 R' U' R U R' U' R U' R'", solution: "R U R' U R U' R' U R U2 R'" },
                { id: "oll_004", case: "R' U2 R2 U R2 U R2 U2 R'", solution: "R U2 R2 U' R2 U' R2 U2 R" },
                { id: "oll_005", case: "F R' F' Rw U R U' Rw'", solution: "Rw U R' U' Rw' F R F'" },
                { id: "oll_006", case: "R' U2 R' D' R U2 R' D R2", solution: "R2 D' R U2 R' D R U2 R" },
                { id: "oll_007", case: "F' L' F R' F' L F R", solution: "R' F' L' F R F' L F" },
                { id: "oll_008", case: "F U R U' R' F'", solution: "F R U R' U' F'" },
                { id: "oll_009", case: "F R' F' R U R U' R'", solution: "R U R' U' R' F R F'" },
                { id: "oll_010", case: "F R U R' U' F'", solution: "F U R U' R' F'" },
                { id: "oll_011", case: "R' F' U' F U R", solution: "R' U' F' U F R" },
                { id: "oll_012", case: "Fw R' F' R U R U' R' S'", solution: "S R U R' U' R' F R Fw'" },
                { id: "oll_013", case: "R' F R U R' U' F' U R", solution: "R' U' F U R U' R' F' R" },
                { id: "oll_014", case: "F U R U' R' U R U' R' F'", solution: "F R U R' U' R U R' U' F'" },
                { id: "oll_015", case: "R' U' F R' F' R F R' F' R U R", solution: "R' U' R' F R F' R' F R F' U R" },
                { id: "oll_016", case: "Lw' U2 L U L' U' L U L' U Lw", solution: "Lw' U' L U' L' U L U' L' U2 Lw" },
                { id: "oll_017", case: "Rw U2 R' U' R U R' U' R U' Rw'", solution: "Rw U R' U R U' R' U R U2 Rw'" },
                { id: "oll_018", case: "R B' R2 F R2 B R2 F' R", solution: "R' F R2 B' R2 F' R2 B R'" },
                { id: "oll_019", case: "Rw' U Rw2 U' Rw2 U' Rw2 U Rw'", solution: "Rw U' Rw2 U Rw2 U Rw2 U' Rw" },
                { id: "oll_020", case: "R U R' U' R' F R F'", solution: "F R' F' R U R U' R'" },
                { id: "oll_021", case: "R U2 R' F R' F' R2 U2 R'", solution: "R U2 R2 F R F' R U2 R'" },
                { id: "oll_022", case: "Lw' U' L U' L' U2 Lw", solution: "Lw' U2 L U L' U Lw" },
                { id: "oll_023", case: "Rw U R' U R U2 Rw'", solution: "Rw U2 R' U' R U' Rw'" },
                { id: "oll_024", case: "Rw U2 R' U' R U' Rw'", solution: "Rw U R' U R U2 Rw'" },
                { id: "oll_025", case: "Lw' U2 L U L' U Lw", solution: "Lw' U' L U' L' U2 Lw" },
                { id: "oll_026", case: "M U' R U2 R' U' R U' R' M'", solution: "M R U R' U R U2 R' U M'" },
                { id: "oll_027", case: "M' U R' U2 R U R' U R M", solution: "M' R' U' R U' R' U2 R U' M" },
                { id: "oll_028", case: "Rw U R' U' Rw' R U R U' R'", solution: "R U R' U' Rw R' U R U' Rw'" },
                { id: "oll_029", case: "R U R' U' Rw R' U R U' Rw'", solution: "Rw U R' U' Rw' R U R U' R'" },
                { id: "oll_030", case: "F R U R' U' R U R' U' F'", solution: "F U R U' R' U R U' R' F'" },
                { id: "oll_031", case: "R U' R' U' R U R2 F R2 U R' U' R' F' R", solution: "R' F R U R U' R2 F' R2 U' R' U R U R'" },
                { id: "oll_032", case: "R' U' R U' R' U F' U F R", solution: "R' F' U' F U' R U R' U R" },
                { id: "oll_033", case: "Rw U Rw' R U R' U' R U R' U' Rw U' Rw'", solution: "Rw U Rw' U R U' R' U R U' R' Rw U' Rw'" },
                { id: "oll_034", case: "R' U' F R' F' R U R", solution: "R' U' R' F R F' U R" },
                { id: "oll_035", case: "F U R' U' R' F' R U R2 U' R'", solution: "R U R2 U' R' F R U R U' F'" },
                { id: "oll_036", case: "F R' F' R U R U R' U' R U' R'", solution: "R U R' U R U' R' U' R' F R F'" },
                { id: "oll_037", case: "F' L F L' U' L' U' L U L' U L", solution: "L' U' L U' L' U L U L F' L' F" },
                { id: "oll_038", case: "L F' L' U' L U F U' L'", solution: "L F' L' U' L U F U' L'" },
                { id: "oll_039", case: "R' U' F U R U' R' F' R", solution: "R' F R U R' U' F' U R" },
                { id: "oll_040", case: "F U F' R' F R U' R' F' R", solution: "R' F R U R' F' R F U' F'" },
                { id: "oll_041", case: "F' U' F Rw U' Rw' U Rw U Rw'", solution: "Rw U' Rw' U' Rw U Rw' F' U F" },
                { id: "oll_042", case: "Rw U Rw' U R U' M' U' Rw'", solution: "Rw U M U R' U' Rw U' Rw'" },
                { id: "oll_043", case: "Lw' U' Lw U' L' U M' U Lw", solution: "Lw' U' M U' L U Lw' U Lw" },
                { id: "oll_044", case: "R U' R' F' U F R U R' U R U' R'", solution: "R U R' U' R U' R' F' U' F R U R'" },
                { id: "oll_045", case: "F U R U2 R' U R U2 R' U' F'", solution: "F U R U2 R' U' R U2 R' U' F'" },
                { id: "oll_046", case: "F U R U' R' F' R U2 R' U' R U' R'", solution: "R U R' U R U2 R' F R U R' U' F'" },
                { id: "oll_047", case: "F U R U' R' F' R' U2 R U R' U R", solution: "R' U' R U' R' U2 R F R U R' U' F'" },
                { id: "oll_048", case: "F U R U' R2 F' R U R U' R'", solution: "R U R' U' R' F R2 U R' U' F'" },
                { id: "oll_049", case: "R U2 R' F R' F' R U' R U' R'", solution: "R U R' U R' F R F' R U2 R'" },
                { id: "oll_050", case: "Rw U R' U' M2 U R U' R' U' M'", solution: "Rw U R' U' M2 U R U' R' U' M'" },
                { id: "oll_051", case: "F R' F' R2 Rw' U R U' R' U' R' Rw", solution: "Rw' R U R U R' U' Rw R2 F R F'" },
                { id: "oll_052", case: "Rw' U2 R U R' U Rw2 U2 R' U' R U' Rw'", solution: "Rw U R' U R U2 Rw2 U' R U' R' U2 Rw" },
                { id: "oll_053", case: "F R' F' R U2 F R' F' R U' R U' R'", solution: "R U R' U R' F R F' U2 R' F R F'" },
                { id: "oll_054", case: "F U R U' R' F' U Fw U R U' R' Fw'", solution: "Fw R U R' U' Fw' U' F R U R' U' F'" },
                { id: "oll_055", case: "F U R U' R' F' U' Fw U R U' R' Fw'", solution: "Fw R U R' U' Fw' U F R U R' U' F'" },
                { id: "oll_056", case: "R U' R2 D' Rw U' Rw' D R2 U R'", solution: "R U' R2 D' Rw U Rw' D R2 U R'" },
                { id: "oll_057", case: "F R' F' R U2 F R' F' R2 U2 R'", solution: "R U2 R2 F R F' U2 R' F R F'" }
            ],
            PLL: [
                { id: "pll_ua", case: "R2 U' R' U' R U R U R U' R", solution: "R' U R' U' R' U' R' U R U R2" },
                { id: "pll_ub", case: "R' U R' U' R' U' R' U R U R2", solution: "R2 U' R' U' R U R U R U' R" },
                { id: "pll_h", case: "M2 U M2 U2 M2 U M2", solution: "M2 U M2 U2 M2 U M2" },
                { id: "pll_z", case: "M2 U M2 U M' U2 M2 U2 M' U2", solution: "M2 U M2 U M' U2 M2 U2 M' U2" },
                { id: "pll_aa", case: "x R' U R' D2 R U' R' D2 R2", solution: "x R2 D2 R U R' D2 R U' R" },
                { id: "pll_ab", case: "x R2 D2 R U R' D2 R U' R", solution: "x R' U R' D2 R U' R' D2 R2" },
                { id: "pll_t", case: "R U R' U' R' F R2 U' R' U' R U R' F'", solution: "R U R' U' R' F R2 U' R' U' R U R' F'" },
                { id: "pll_f", case: "R' U' F' R U R' U' R' F R2 U' R' U' R U R' U R", solution: "R' U' F' R U R' U' R' F R2 U' R' U' R U R' U R" },
                { id: "pll_y", case: "F R U' R' U' R U R' F' R U R' U' R' F R F'", solution: "F R U' R' U' R U R' F' R U R' U' R' F R F'" },
                { id: "pll_e", case: "x' R U' R' D R U R' D' R U R' D R U' R' D'", solution: "x' R U' R' D R U R' D' R U R' D R U' R' D'" },
                { id: "pll_ja", case: "R U R' F' R U R' U' R' F R2 U' R' U'", solution: "R U R' F' R U R' U' R' F R2 U' R' U'" },
                { id: "pll_jb", case: "x R2 F R F' R U2 Rw' U Rw U2 x'", solution: "x R2 F R F' R U2 Rw' U Rw U2 x'" },
                { id: "pll_ra", case: "R' U2 R U2 R' F R U R' U' R' F' R2 U'", solution: "R' U2 R U2 R' F R U R' U' R' F' R2 U'" },
                { id: "pll_rb", case: "R U' R' U' R U R D R' U' R D' R' U2 R'", solution: "R U' R' U' R U R D R' U' R D' R' U2 R'" },
                { id: "pll_na", case: "R U R' U R U R' F' R U R' U' R' F R2 U' R' U2 R U' R'", solution: "R U R' U R U R' F' R U R' U' R' F R2 U' R' U2 R U' R'" },
                { id: "pll_nb", case: "R' U R U' R' F' U' F R U R' F R' F' R U' R", solution: "R' U R U' R' F' U' F R U R' F R' F' R U' R" },
                { id: "pll_v", case: "R' U R' U' y R' F' R2 U' R' U R' F R F", solution: "R' U R' U' y R' F' R2 U' R' U R' F R F" },
                { id: "pll_ga", case: "D R' U' R D' U R2 U R' U R U' R U' R2", solution: "R2 U R' U R' U' R U' R2 U' D R' U R D'" },
                { id: "pll_gb", case: "D' R2 U R' U R' U' R U' R2 D U' R' U R", solution: "R' U' R U D' R2 U R' U R U' R U' R2 D" },
                { id: "pll_gc", case: "D' R U R' D U' R2 U' R U' R' U R' U R2", solution: "R2 U' R U' R U R' U R2 U D' R U' R' D" },
                { id: "pll_gd", case: "D R2 U' R U' R U R' U R2 D' U R U' R'", solution: "R U R' U' D R2 U' R U' R' U R' U R2 D'" }
            ]
        };

        // Estado da aplica√ß√£o
        let appState = {
            currentScreen: 'home',
            currentCategory: '',
            currentAlgorithm: null,
            sessionAlgorithms: [],
            reviewMode: false,
            selectedAlgorithms: []
        };

        // Carregar dados salvos
        function loadData() {
            const saved = localStorage.getItem('cubeTrainerData');
            if (saved) {
                return JSON.parse(saved);
            }
            return {
                progress: {
                    F2L: {
                        completed: [],
                        mastered: [],
                        currentStreak: 0,
                        totalPracticed: 0,
                        selectedForReview: []
                    },
                    OLL: {
                        completed: [],
                        mastered: [],
                        currentStreak: 0,
                        totalPracticed: 0,
                        selectedForReview: []
                    },
                    PLL: {
                        completed: [],
                        mastered: [],
                        currentStreak: 0,
                        totalPracticed: 0,
                        selectedForReview: []
                    }
                },
                settings: {
                    theme: 'dark',
                    fontSize: 'normal',
                    includeMastered: false,
                    reverseMode: false,
                    soundEnabled: false
                },
                statistics: {
                    totalSessions: 0,
                    customReviewSessions: 0,
                    lastSession: null
                }
            };
        }

        // Salvar dados
        function saveData() {
            const data = loadData();
            localStorage.setItem('cubeTrainerData', JSON.stringify(data));
        }

        // Inicializar aplica√ß√£o
        function init() {
            // Garantir tema escuro como padr√£o se n√£o houver dados salvos
            const data = loadData();
            if (!localStorage.getItem('cubeTrainerData')) {
                document.documentElement.setAttribute('data-theme', 'dark');
                document.body.setAttribute('data-theme', 'dark');
            }
            updateHomeScreen();
            loadSettings();
        }

        // Navegar entre telas
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
            appState.currentScreen = screenId;

            if (screenId === 'home') {
                updateHomeScreen();
            } else if (screenId === 'settings') {
                updateStatistics();
            }
        }

        // Atualizar tela inicial
        function updateHomeScreen() {
            const data = loadData();
            
            ['F2L', 'OLL', 'PLL'].forEach(category => {
                const progress = data.progress[category];
                const total = algorithmData[category].length;
                const completed = progress.mastered.length;
                const percentage = (completed / total) * 100;

                document.getElementById(`${category.toLowerCase()}-progress`).style.width = percentage + '%';
                document.getElementById(`${category.toLowerCase()}-progress-text`).textContent = `${completed}/${total} conclu√≠dos`;
            });
        }

        // Iniciar treino
        function startTraining(category) {
            appState.currentCategory = category;
            appState.reviewMode = false;
            appState.sessionAlgorithms = [];
            
            const data = loadData();
            data.statistics.totalSessions++;
            data.statistics.lastSession = Date.now();
            saveData();

            document.getElementById('training-title').textContent = `Treino de ${category}`;
            showScreen('training');
            nextAlgorithm();
        }

        // Pr√≥ximo algoritmo
        function nextAlgorithm() {
            const data = loadData();
            const settings = data.settings;
            const categoryData = algorithmData[appState.currentCategory];
            let availableAlgorithms;

            if (appState.reviewMode) {
                availableAlgorithms = categoryData.filter(algo => 
                    appState.selectedAlgorithms.includes(algo.id) &&
                    !appState.sessionAlgorithms.includes(algo.id)
                );
            } else {
                availableAlgorithms = categoryData.filter(algo => 
                    !appState.sessionAlgorithms.includes(algo.id) &&
                    (settings.includeMastered || !data.progress[appState.currentCategory].mastered.includes(algo.id))
                );
            }

            if (availableAlgorithms.length === 0) {
                document.getElementById('end-session-modal').classList.add('active');
                return;
            }

            // Sortear algoritmo
            const randomIndex = Math.floor(Math.random() * availableAlgorithms.length);
            appState.currentAlgorithm = availableAlgorithms[randomIndex];
            appState.sessionAlgorithms.push(appState.currentAlgorithm.id);

            // Atualizar display
            const caseText = settings.reverseMode ? appState.currentAlgorithm.solution : appState.currentAlgorithm.case;
            const solutionText = settings.reverseMode ? appState.currentAlgorithm.case : appState.currentAlgorithm.solution;

            document.getElementById('algorithm-case').textContent = caseText;
            document.getElementById('solution-text').textContent = solutionText;
            document.getElementById('solution-area').classList.add('hidden');

            // Atualizar status
            const status = data.progress[appState.currentCategory].mastered.includes(appState.currentAlgorithm.id) ? 'mastered' : 'new';
            const statusElement = document.getElementById('algorithm-status');
            statusElement.className = `algorithm-status status-${status}`;
            statusElement.textContent = status === 'mastered' ? 'Dominado' : 'Novo';

            // Atualizar contador e progresso
            const total = appState.reviewMode ? appState.selectedAlgorithms.length : categoryData.length;
            const current = appState.sessionAlgorithms.length;
            document.getElementById('training-counter').textContent = `Algoritmo ${current} de ${total}`;
            document.getElementById('training-progress-bar').style.width = `${(current / total) * 100}%`;

            // Atualizar estat√≠sticas
            data.progress[appState.currentCategory].totalPracticed++;
            saveData();
        }

        // Mostrar/ocultar solu√ß√£o
        function toggleSolution() {
            const solutionArea = document.getElementById('solution-area');
            solutionArea.classList.toggle('hidden');
            
            if (appState.currentAlgorithm && !solutionArea.classList.contains('hidden')) {
                const data = loadData();
                if (!data.progress[appState.currentCategory].completed.includes(appState.currentAlgorithm.id)) {
                    data.progress[appState.currentCategory].completed.push(appState.currentAlgorithm.id);
                    saveData();
                }
            }
        }

        // Marcar como dominado
        function markAsMastered() {
            if (!appState.currentAlgorithm) return;

            const data = loadData();
            const progress = data.progress[appState.currentCategory];
            
            if (!progress.mastered.includes(appState.currentAlgorithm.id)) {
                progress.mastered.push(appState.currentAlgorithm.id);
                progress.currentStreak++;
                
                const statusElement = document.getElementById('algorithm-status');
                statusElement.className = 'algorithm-status status-mastered';
                statusElement.textContent = 'Dominado';
                
                saveData();
                updateHomeScreen();
            }
        }

        // Mostrar sele√ß√£o de algoritmos
        function showSelection(category) {
            appState.currentCategory = category;
            showScreen('selection');
            // Sempre carrega os algoritmos salvos
            const data = loadData();
            appState.selectedAlgorithms = data.progress[category].selectedForReview || [];
            loadAlgorithmList();
        }

        // Carregar lista de algoritmos para sele√ß√£o
        function loadAlgorithmList() {
            const data = loadData();
            const categoryData = algorithmData[appState.currentCategory];
            const savedSelection = data.progress[appState.currentCategory].selectedForReview || [];
            const listContainer = document.getElementById('algorithm-list');
            
            listContainer.innerHTML = '';
            
            categoryData.forEach((algo, index) => {
                const item = document.createElement('div');
                item.className = 'algorithm-item';
                if (savedSelection.includes(algo.id)) {
                    item.classList.add('selected');
                }
                
                const isMastered = data.progress[appState.currentCategory].mastered.includes(algo.id);
                
                item.innerHTML = `
                    <input type="checkbox" id="algo-${algo.id}" ${savedSelection.includes(algo.id) ? 'checked' : ''} onchange="toggleAlgorithmSelection('${algo.id}')">
                    <div class="algorithm-item-content">
                        <div class="algorithm-item-case">Caso ${index + 1}: ${algo.case}</div>
                        <div class="algorithm-item-solution">Solu√ß√£o: ${algo.solution}</div>
                        <div class="algorithm-status status-${isMastered ? 'mastered' : 'new'}" style="margin-top: 4px;">
                            ${isMastered ? 'Dominado' : 'Novo'}
                        </div>
                    </div>
                `;
                
                listContainer.appendChild(item);
            });
            
            appState.selectedAlgorithms = [...savedSelection];
            updateSelectionCounter();
        }

        // Alternar sele√ß√£o de algoritmo
        function toggleAlgorithmSelection(algoId) {
            const index = appState.selectedAlgorithms.indexOf(algoId);
            const item = document.querySelector(`#algo-${algoId}`).closest('.algorithm-item');
            
            if (index === -1) {
                appState.selectedAlgorithms.push(algoId);
                item.classList.add('selected');
            } else {
                appState.selectedAlgorithms.splice(index, 1);
                item.classList.remove('selected');
            }
            
            // Salvar sele√ß√£o
            const data = loadData();
            data.progress[appState.currentCategory].selectedForReview = [...appState.selectedAlgorithms];
            saveData();
            
            updateSelectionCounter();
        }

        // Selecionar m√∫ltiplos algoritmos
        function selectMultiple(count) {
            const categoryData = algorithmData[appState.currentCategory];
            const unselected = categoryData.filter(algo => !appState.selectedAlgorithms.includes(algo.id));
            
            const toSelect = unselected.slice(0, Math.min(count, unselected.length));
            toSelect.forEach(algo => {
                appState.selectedAlgorithms.push(algo.id);
                const checkbox = document.getElementById(`algo-${algo.id}`);
                if (checkbox) {
                    checkbox.checked = true;
                    checkbox.closest('.algorithm-item').classList.add('selected');
                }
            });
            
            // Salvar sele√ß√£o
            const data = loadData();
            data.progress[appState.currentCategory].selectedForReview = [...appState.selectedAlgorithms];
            saveData();
            
            updateSelectionCounter();
        }

        // Selecionar todos
        function selectAll() {
            const categoryData = algorithmData[appState.currentCategory];
            appState.selectedAlgorithms = categoryData.map(algo => algo.id);
            
            document.querySelectorAll('.algorithm-item input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = true;
                checkbox.closest('.algorithm-item').classList.add('selected');
            });
            
            // Salvar sele√ß√£o
            const data = loadData();
            data.progress[appState.currentCategory].selectedForReview = [...appState.selectedAlgorithms];
            saveData();
            
            updateSelectionCounter();
        }

        // Limpar sele√ß√£o
        function clearSelection() {
            appState.selectedAlgorithms = [];
            
            document.querySelectorAll('.algorithm-item input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
                checkbox.closest('.algorithm-item').classList.remove('selected');
            });
            
            // Salvar sele√ß√£o
            const data = loadData();
            data.progress[appState.currentCategory].selectedForReview = [];
            saveData();
            
            updateSelectionCounter();
        }

        // Selecionar apenas n√£o dominados
        function selectNonMastered() {
            const data = loadData();
            const categoryData = algorithmData[appState.currentCategory];
            const nonMastered = categoryData.filter(algo => 
                !data.progress[appState.currentCategory].mastered.includes(algo.id)
            );
            
            clearSelection();
            appState.selectedAlgorithms = nonMastered.map(algo => algo.id);
            
            appState.selectedAlgorithms.forEach(algoId => {
                const checkbox = document.getElementById(`algo-${algoId}`);
                if (checkbox) {
                    checkbox.checked = true;
                    checkbox.closest('.algorithm-item').classList.add('selected');
                }
            });
            
            // Salvar sele√ß√£o
            data.progress[appState.currentCategory].selectedForReview = [...appState.selectedAlgorithms];
            saveData();
            
            updateSelectionCounter();
        }

        // Selecionar apenas dominados
        function selectMastered() {
            const data = loadData();
            const categoryData = algorithmData[appState.currentCategory];
            const mastered = categoryData.filter(algo => 
                data.progress[appState.currentCategory].mastered.includes(algo.id)
            );
            
            clearSelection();
            appState.selectedAlgorithms = mastered.map(algo => algo.id);
            
            appState.selectedAlgorithms.forEach(algoId => {
                const checkbox = document.getElementById(`algo-${algoId}`);
                if (checkbox) {
                    checkbox.checked = true;
                    checkbox.closest('.algorithm-item').classList.add('selected');
                }
            });
            
            // Salvar sele√ß√£o
            data.progress[appState.currentCategory].selectedForReview = [...appState.selectedAlgorithms];
            saveData();
            
            updateSelectionCounter();
        }

        // Atualizar contador de sele√ß√£o
        function updateSelectionCounter() {
            const count = appState.selectedAlgorithms.length;
            document.getElementById('selection-counter').textContent = `${count} selecionados`;
            document.getElementById('start-review-btn').textContent = `Iniciar Revis√£o com ${count} Algoritmos`;
            document.getElementById('start-review-btn').disabled = count === 0;
        }

        // Iniciar revis√£o
        function startReview() {
            if (appState.selectedAlgorithms.length === 0) return;
            
            appState.reviewMode = true;
            appState.sessionAlgorithms = [];
            
            const data = loadData();
            data.statistics.customReviewSessions++;
            saveData();
            
            document.getElementById('training-title').textContent = `Revis√£o Personalizada - ${appState.currentCategory}`;
            showScreen('training');
            nextAlgorithm();
        }

        // Reiniciar sess√£o
        function restartSession() {
            appState.sessionAlgorithms = [];
            document.getElementById('end-session-modal').classList.remove('active');
            nextAlgorithm();
        }

        // Encerrar sess√£o
        function endSession() {
            document.getElementById('end-session-modal').classList.remove('active');
            showScreen('home');
        }

        // Modal de confirma√ß√£o
        let confirmCallback = null;

        function confirmReset(category) {
            const modal = document.getElementById('confirm-modal');
            const title = document.getElementById('modal-title');
            const message = document.getElementById('modal-message');
            
            if (category === 'ALL') {
                title.textContent = 'Resetar Todos os Dados';
                message.textContent = 'Tem certeza que deseja resetar todos os dados de todas as categorias? Esta a√ß√£o n√£o pode ser desfeita.';
                confirmCallback = () => resetAllData();
            } else {
                title.textContent = `Resetar Dados de ${category}`;
                message.textContent = `Tem certeza que deseja resetar todos os dados da categoria ${category}? Esta a√ß√£o n√£o pode ser desfeita.`;
                confirmCallback = () => resetCategoryData(category);
            }
            
            modal.classList.add('active');
        }

        function confirmAction() {
            if (confirmCallback) {
                confirmCallback();
            }
            closeModal();
        }

        function closeModal() {
            document.getElementById('confirm-modal').classList.remove('active');
            confirmCallback = null;
        }

        // Resetar dados de categoria
        function resetCategoryData(category) {
            const data = loadData();
            data.progress[category] = {
                completed: [],
                mastered: [],
                currentStreak: 0,
                totalPracticed: 0,
                selectedForReview: []
            };
            saveData();
            updateHomeScreen();
        }

        // Resetar todos os dados
        function resetAllData() {
            localStorage.removeItem('cubeTrainerData');
            updateHomeScreen();
            loadSettings();
        }

        // Configura√ß√µes
        function toggleDarkMode() {
            const isDark = document.getElementById('dark-mode-toggle').checked;
            document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
            
            const data = loadData();
            data.settings.theme = isDark ? 'dark' : 'light';
            saveData();
        }

        function changeFontSize() {
            const size = document.getElementById('font-size-select').value;
            document.body.className = size !== 'normal' ? `font-${size}` : '';
            
            const data = loadData();
            data.settings.fontSize = size;
            saveData();
        }

        function saveSettings() {
            const data = loadData();
            data.settings.includeMastered = document.getElementById('include-mastered').checked;
            data.settings.reverseMode = document.getElementById('reverse-mode').checked;
            data.settings.soundEnabled = document.getElementById('sound-enabled').checked;
            saveData();
        }

        function loadSettings() {
            const data = loadData();
            const settings = data.settings;
            
            // Aplicar tema escuro como padr√£o se n√£o houver dados salvos
            const isFirstTime = !localStorage.getItem('cubeTrainerData');
            const theme = isFirstTime ? 'dark' : settings.theme;
            
            document.getElementById('dark-mode-toggle').checked = theme === 'dark';
            document.getElementById('font-size-select').value = settings.fontSize;
            document.getElementById('include-mastered').checked = settings.includeMastered;
            document.getElementById('reverse-mode').checked = settings.reverseMode;
            document.getElementById('sound-enabled').checked = settings.soundEnabled;
            
            document.documentElement.setAttribute('data-theme', theme);
            document.body.className = settings.fontSize !== 'normal' ? `font-${settings.fontSize}` : '';
        }

        // Estat√≠sticas
        function updateStatistics() {
            const data = loadData();
            let totalPracticed = 0;
            let totalMastered = 0;
            
            ['F2L', 'OLL', 'PLL'].forEach(category => {
                totalPracticed += data.progress[category].totalPracticed;
                totalMastered += data.progress[category].mastered.length;
            });
            
            document.getElementById('total-practiced').textContent = totalPracticed;
            document.getElementById('total-mastered').textContent = totalMastered;
            document.getElementById('review-sessions').textContent = data.statistics.customReviewSessions;
            document.getElementById('current-streak').textContent = Math.max(
                data.progress.F2L.currentStreak,
                data.progress.OLL.currentStreak,
                data.progress.PLL.currentStreak
            );
        }

        // Exportar/Importar dados
        function exportData() {
            const data = loadData();
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `cube-trainer-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const data = JSON.parse(event.target.result);
                            localStorage.setItem('cubeTrainerData', JSON.stringify(data));
                            location.reload();
                        } catch (error) {
                            alert('Erro ao importar dados. Verifique se o arquivo est√° correto.');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            
            input.click();
        }

        // Inicializar aplica√ß√£o ao carregar
        window.onload = init;
    </script>
</body>
</html>